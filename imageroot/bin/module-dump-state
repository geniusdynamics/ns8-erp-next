#!/bin/bash

#
# Copyright (C) 2022 Nethesis S.r.l.
# SPDX-License-Identifier: GPL-3.0-or-later
#

set -e

if ! systemctl --user -q is-active erpnext.service; then
    exit 0
fi

#Creating A manual back up from internal app
SITE="frontend"
BACKUP_FILE="backup_paths.txt"

backup_and_save_paths()
{
  local site=$1
  local output

  # Run the exec to back up the db
  output=$(bench exec backend bench --site "$site" backup)

  # Extract the paths from the output
  local config_path=$(echo "$output" | grep -oP '(?<=Config\s+:\s).+')
  local db_path=$(echo "$output" | grep -oP '(?<=Database:\s).+')

  # Save the paths to a file
  echo "CONFIG_PATH=$config_path" > "$BACKUP_FILE"
  echo "DB_PATH=$db_path" >> "$BACKUP_FILE"

  echo "Backup paths saved to $BACKUP_FILE"
}

backup_and_save_paths "$SITE"